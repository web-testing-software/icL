\begin{lstlisting}
```
	Life Sport v. 1.3.0
	release day 15.09.2016
	Author: lixcode
```
init = {
	#old = [
		datetime, 
		state : string, 
		competition : string, 
		title : string
	];
	#new = @old.clone();
	#added = @old.clone();
	#toAdd = @old.clone();
}

parse_bat = {
	Tab.get #url_source;

	$run {
		(function(){
			selectTimeZome('+0')
		})()
	}

	@ls = DOM.queryAll ".lshpanel";

	for (@ls) {
		@obj = [=];

		@datetime_str = @.query(".riginal_time")'attr-innerText;
		@obj'datetime = @datetime_str : (datetime, "SSXE");

		
		@obj'country = parse_bat_country @;

		@competition = @.query(".category")'attr-innerText;
		@regex = //\s\-\s([\w\s]+)//
		
		@obj'competition = exists(@competition <* @regx)'0 | @competition;

		@obj'title = @.query(".lshevent")'attr-innerText;

		@new.insert @obj;
	}
}

@us = ["mlb", "wnba", "nascar"];
@eu = ["el", "slr"];
@ru = ["khl"];
@nz = ["itmcup"];
@au = ["nrl"];
@xx = ["ae", "af", "ai", "al", "ar", "at", "au", "az", "bg", "bo", "ba", "be", "bh", "by", "ca", "ch", "br", "cl", "cr", "cn", "co", "cy", "cz", "de", "dk", "ee", "dz", "ec", "eg", "es", "eu", "fi", "fr", "gb", "gr", "hk", "gh", "gt", "hn", "hu", "id", "ie", "il", "in", "ir", "is", "hr", "ig", "it", "ix", "jp", "kp", "kr", "lk", "lt", "lv", "kw", "ly", "me", "mk", "nc", "nl", "no", "nz", "om", "ma", "mn", "mx", "pl", "pt", "qa", "ro", "rs", "ru", "s2", "my", "np", "sa", "se", "sg", "si", "sk", "tr", "ua", "us", "sv", "tn", "wa", "za", "w"];

parse_bat_country = (element) : string {
	@country_str = @element.query("tr > td:first-child")'attr-style;
	@country = (@country_str <* //(\w+).png//)'0 | "";

	     if (@eu << @country) { @country = "eu" }
	else if (@us << @country) { @country = "us" }
	else if (@ru << @country) { @country = "ru" }
	else if (@nz << @country) { @country = "nz" }
	else if (@au << @country) { @country = "au" }
	else if (@xx !< @country) { @country = "" }

	Stack.return @country;
}

parse_source = {
	Tab.get #url_source;

	$run {
		(function(){
			changetTimeZone("+00:00")
		})()
	}

	@trs = DOM.queryAll ".HomeTable tr:not(:first-child)";

	for (@trs) {
		@obj = [=];

		@date_str = @.query("td:nth-child(2)")'attr-innerText;
		@time_str = @.query("td:nth-child(3)")'attr-innerText;

		@obj'datetime = parse_date (@date_str, @time_str);
		@obj'country = @.query(".country-icon")'attr-innerText;
		@obj'competition = @.query("td:nth-child(5")'attr-innerText;

		#new.insert @obj;
	}
}

@months = ["",
	"Jan", "Feb", "Mar",
	"Apr", "May", "Jun",
	"Jul", "Aug", "Sep",
	"Oct", "Nov", "Dec"
];

parse_date (date : string, time : string) : datetime = {
	@dt = Make.currentDatetime;

	@hm = @time ** //(?<hour>\d+).(?<min>\d+)//;

	@dt'hour = @hm'hour : int;
	@dt'minute = @hm'min : int;

	if (date !< "Today") {
		Stacks'root.return @dt;
	}

	if (date << "Tomorrow") {
		@dt.addDays 1;
	}
	else {
		@regex = //(?<day>\d+).(?<month>\w+).(?<year>\d+)//;
		@data = @date ** @regex;

		if exists(@data) {
			@dt'day = @data'day : int;
			@dt'month = @month.indexOf @data'month;
			@dt'year = @data'year : int;
		}
	}

	Stack.return @dt;
}

css = (@selector : string) : element {
	@ = DOM.query @selector;
}

add_data = {
	Tab.get "../admin.php";

	css("input[name=username]").sendKeys "user....";
	css("input[name=password]").sendKeys "pass....";

	for (#toAdd) {
		Tab.get "../admin.php?mod=addnews&action=addnews";

		css(".icon-tasks").click();
		css("#autodescr").sendKeys "WO " + @'title + "Keywords";
		css(".icon-home").click();
		css("#title").sendKeys @'title;
		css("#allow_date").click();
		css("input[name=newdate]").sendKeys(@.datetime : (string, "yyyy-MM-dd hh:mm:ss"));
		css("#title").click();
		css("#xf_liga").sendKeys @'country;
		css("#xf_com").sendKeys @'competition;
		css("#xf_duration").sendKeys "4";
		css(".btn-green").click();

		#added.insert @;
	}
}

main = {
	@id = css("#id")'text;

	@source1 = [
		bb = "baseball-live-streaming",
		fb = "football-live-stream-5",
		...
	];

	@source2 = [
		bb = "baseball-streaming-online",
		fb = "football-live-streaming-video-2016-19.html",
		...
	];

	@file = Files.create @id;

	#old = DSV.loadCSV (@file, #old);

	@source = "";

	if (css("#source1")'selected) {
		@source = "http://../" + (@source1.get @id);
		parse_source();
	}
	else if (css("#source2")) {
		@source = "http://../" + (@source2.get @id);
		parse_bat();
	}

	#toAdd = #new \ #old;
	#added = #new * #old;
	
	DSV.sync (@file, #added);

	if exists(@source) {
		add_data();
	}
}

`` initial actions

Tab.get "local_file.html";

$run {
	document.getElementById("go").onlick = function() {
		!{main}()
	}
}
\end{lstlisting}
