\section{Интеграция с Javascript}

В языке icL {\bf интеграция с Javascript} отличается в разных режимах работы. {\bf Режимы работы} всего 2: тестирование и автоматизация. В дальнейшем параграфы будут отмечены следующим меткам: \mintinline{icl}{[icL]} - относиться к автоматизации и расширенных возможностях icL, \mintinline{icl}{[w3c]} - относиться к тестированию и стандарту WebDriver предложен World Wide Web Consortium.

\subsection{JS-Значения}

{\bf JS-Значения} - главное нововведение по интеграцию с JavaScript. Оно позволяет использовать переменные JavaScript удобно, как и переменных icL. Они также могут быть доступны только для чтения или для записи и чтения.

Каждое JS-Значение имеет геттер, но только переменные доступны для записи и чтения имеют сеттер. Геттеры и сеттеры являются фрагментами кода на языке JavaScript. В сеттере установленное значение передаётся следующим кодом \mintinline{icl}{@\{value\}} Синтаксис JS-Значений:
\begin{minted}{icl}
$value {getter; setter};
\end{minted}

Упрощённый синтаксис JS-Значений:
\begin{minted}{icl}
$value {getter};
\end{minted}

В качестве JS-Значений может объявить любое переменное, на пример название страницы (см. листинг \ref{jsvalueex}), она остаётся доступной даже после перехода на другой странице.

\begin{sourcecode}
	\captionof{listing}{Использование JS-Значений}
	\label{jsvalueex}
    \inputminted[linenos]{icl}{../sources/jsvalueex.icL}
\end{sourcecode}

\subsection{Выполнение кода на языке JavaScript}

Команда \mintinline{icl}{$run} позволяет выполнить {\bf код на языке JavaScript}.

\mintinline{icl}{[icL]} Команда \mintinline{icl}{$run} получает один аргумент - код, в коде могут присутствовать переменные icL. Глобальные переменные предаются следующим образом \mintinline{icl}{#{name}}, локальные - \mintinline{icl}{@{name}}. Пример передачи значений перемены в JavaScript представлен на листинге \ref{jsrunex1}. Код можно выполнить асинхронно используя \mintinline{icl}{$runAsync}.

\begin{sourcecode}
	\captionof{listing}{Выполнение кода на языке JavaScript (icL)}
	\label{jsrunex1}
    \inputminted[linenos]{icl}{../sources/jsrunex1.icL}
\end{sourcecode}

\mintinline{icl}{[w3c]} Команда \mintinline{icl}{$run} получает переменное количество переменных. Они передаются в коде на языке JavaScript в виде аргументов вызова функций. Доступ к ним осуществляется с помощью переменной \mintinline{icl}{arguments}. Код использующий данную тактику представлен на листинге \ref{jsrunex2}, его можно сравнивать с листингом \ref{jsrunex1}. Код можно выполнить асинхронно используя \mintinline{icl}{$runAsync}.

\begin{sourcecode}
	\captionof{listing}{Выполнение кода на языке JavaScript (w3c)}
	\label{jsrunex2}
    \inputminted[linenos]{icl}{../sources/jsrunex2.icL}
\end{sourcecode}

Возможные исключения: \ferror{JavascriptError}, \ferror{ScriptTimeout} (см. таб. \ref{errors}).

\subsection{Выполнения файлов}

Команда \mintinline{icl}{$file} {\bf выполняет файлы} JavaScript (.js). Для этого достаточно передать путь к файлу в качестве аргумента.

Синтаксис -
\begin{minted}{icl}
$file "path/to/file.js";
\end{minted}

Возможные исключения: \ferror{FileNotFound}, \ferror{JavascriptError} (см. таб. \ref{errors}).

\subsection{Пользовательские скрипты}

\mintinline{icl}{[icL]} {\bf Пользовательские скрипты} выполняются до загрузки страницы, при переходе на страницу. Скрипт можно подкрепить как к текущей вкладке (\mintinline{icl}{$user}) так и ко всех вкладок из сессии (\mintinline{icl}{$always}).

\mintinline{icl}{[icL]} Синтаксис -
\begin{minted}{icl}
$user "path/to/file.js";
$always "path/to/file.js";
\end{minted}

Возможные исключения: \ferror{FileNotFound} (см. таб. \ref{errors}).

%\newpage
